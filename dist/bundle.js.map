{"version":3,"sources":["webpack://unischeduler_web_ts/./src/unischeduler.ts","webpack://unischeduler_web_ts/webpack/startup"],"names":["reClassName","reClassSection","reClassTime","reLeadingLineWhitespace","reEndingLineWhitespace","createClassSection","className","type","weekdays","startTime","endTime","location","professors","startDate","endDate","byDay","match","map","s","toUpperCase","toString","dtstart","makeDateTime","date","byday","toLowerCase","includes","toUTCString","slice","setUTCDate","getUTCDate","setTrueWeekday","dtend","until","setUTCHours","summary","description","replace","exclude","rrule","time","timeInfo","exec","groups","Error","datetime","Date","hours","parseInt","noonIncrement","isAfterNoon","setUTCMinutes","minutes","add_exdates","icalEvent","exdates","getUTCHours","getUTCMinutes","exdatesCopies","exdate","newDate","getTime","push","normalizeWhitespace","str","getAllRegexMatches","regex","matches","window","convertToIcal","schedule","isUCF","timezone","trim","class_sections","classNames","classSectionBatches","split","shift","all_class_sections","i","length","rawSectionBatch","sectionType","sectionBatch","lastSectionType","section","info","parseSchedule","no_school_events","firstSectionStartDate","year","getUTCFullYear","term","sectionDate","start_month","getUTCMonth","getSectionTerm","json","fetch","exception","console","log","events","event","terms","tags","getUCFNoSchoolEvents","dates","noSchoolEvent","day_count","d","make_timeless_exdates","name","classSections","noSchoolEvents","ics","ICS","tz","creationDate","toDatetime","ical","e","uid","dtStamp","exdateField","toDate","normalize","createIcalString","this","dt","toTime","pad","getUTCSeconds","exdateList","toExdateList","join","foldLine","rangeSize","range","Array","Math","floor","random","randrange","n","line","parts"],"mappings":"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","file":"bundle.js","sourcesContent":["// Good luck figuring this out!\nconst reClassName = /[A-Z]{3}[A-Z]* \\d+[A-Z]? - .+/g;\nconst reClassSection = /(?:(?<sectionType>[A-Z][a-z]+)\\n)?(?<weekdays>(?:[A-Z][a-z])+)\\s+(?<startTime>\\d\\d?:\\d\\d(?:AM|PM))\\s+-\\s+(?<endTime>\\d\\d?:\\d\\d(?:AM|PM))\\n(?<location>.+)\\n(?<professors>\\D+)(?<dtstart>[\\d/]+)\\s+-\\s+(?<dtend>[\\d/]+)/g;\nconst reClassTime = /(?<hours>\\d+)(?::)(?<minutes>\\d+)(?<isAfterNoon>PM)?/;\n\n// Yes, they MUST be separate and CANNOT be combined\n// Otherwise, js can sometimes remove necessary newlines\nconst reLeadingLineWhitespace = /(^\\s+)/gm\nconst reEndingLineWhitespace = /(\\s+$)/gm\n\n\nconst NUMBER_OF_MILLIS_IN_DAY = 86400000\n\ninterface RRule {\n    byDay: string;\n    until: Date;\n}\n\ninterface IcalEvent {\n    summary: string;\n    dtstart: Date;\n    dtend: Date;\n    description: string;\n}\n\ninterface ClassSectionEvent extends IcalEvent {\n    location: string;\n    exclude: Date[];\n    rrule: RRule;\n\n}\n\nfunction createClassSection(\n    className: string, type: string, weekdays: string,\n    startTime: string, endTime: string, location: string,\n    professors: string, startDate: string, endDate: string): ClassSectionEvent {\n    let byDay = weekdays.match(/../g).map((s) => { return s.toUpperCase() }).toString();\n    let dtstart = makeDateTime(startDate, startTime);\n    setTrueWeekday(dtstart, byDay);\n    let dtend = makeDateTime(startDate, endTime);\n    dtend.setUTCDate(dtstart.getUTCDate());\n    let until = makeDateTime(endDate, endTime);\n    until.setUTCHours(0, 0, 0, 0);\n    return {\n        summary: `${className} (${type})`,\n        dtstart: dtstart,\n        dtend: dtend,\n        location: location,\n        description: \"Professors: \" + professors.replace(/\\n/gm, ' '),\n        exclude: [],\n        rrule: {\n            byDay: byDay,\n            until: until,\n        }\n    }\n}\n\nfunction makeDateTime(date: string, time: string) {\n    let timeInfo = reClassTime.exec(time).groups;\n    if (!timeInfo)\n        throw new Error(`Incorrect time format: ${time}`);\n    let datetime = new Date(date);\n    let hours = parseInt(timeInfo.hours)\n    let noonIncrement: number = 0;\n    if (timeInfo.isAfterNoon && hours < 12)\n        noonIncrement = 12;\n    else if (!timeInfo.isAfterNoon && hours == 12)\n        noonIncrement = -12;\n    datetime.setUTCHours(hours + noonIncrement);\n    datetime.setUTCMinutes(parseInt(timeInfo.minutes));\n    return datetime;\n}\n\nfunction setTrueWeekday(date: Date, byday: string) {\n    byday = byday.toLowerCase()\n    while (!byday.includes(date.toUTCString().slice(0, 2).toLowerCase()))\n        date.setUTCDate(date.getUTCDate() + 1)\n}\n\n\n// MAIN\n\n// We assign it to window to be able to use it from html/js on the webpage.\n// The reason we need it is because bundlers such as webpack don't leak any info about bundled packages.\n// @ts-ignore\nwindow.convertToIcal = async function (schedule: string, isUCF: boolean, timezone: string) {\n    schedule = schedule.trim();\n    if (!schedule)\n        throw new Error(\"You inputted an empty schedule.\");\n    let class_sections = parseSchedule(schedule);\n    if (!class_sections)\n        throw new Error(\"Couldn't find any class sections in your schedule. Please, check your schedule or contact my author.\");\n    let firstSectionStartDate = class_sections[0].dtstart;\n    let year = firstSectionStartDate.getUTCFullYear();\n    let term = getSectionTerm(firstSectionStartDate);\n    let no_school_events: IcalEvent[];\n    if (isUCF)\n        no_school_events = await getUCFNoSchoolEvents(year, term);\n    else\n        no_school_events = [];\n    let exdates = make_timeless_exdates(no_school_events);\n    for (let section of class_sections)\n        add_exdates(section, exdates);\n    return createIcalString(`Classes ${term} ${year}`, timezone, class_sections, no_school_events)\n}\n\nfunction getSectionTerm(sectionDate: Date): string {\n    let start_month = sectionDate.getUTCMonth();\n    if (7 <= start_month && start_month <= 9)\n        return \"Fall\";\n    else if (0 <= start_month && start_month <= 2)\n        return \"Spring\";\n    else\n        return \"Summer\";\n}\n\n\nfunction make_timeless_exdates(no_school_events: IcalEvent[]): Date[] {\n    let dates = [];\n    for (let noSchoolEvent of no_school_events) {\n        let day_count = (noSchoolEvent.dtend.getTime() - noSchoolEvent.dtstart.getTime()) / NUMBER_OF_MILLIS_IN_DAY;\n        if (day_count > 1)\n            for (let i = 0; i < day_count + 1; i++) {\n                let newDate = new Date(noSchoolEvent.dtstart);\n                newDate.setUTCDate(newDate.getUTCDate() + i);\n                dates.push(newDate);\n            }\n        else\n            dates.push(noSchoolEvent.dtstart);\n    }\n    console.log(dates.map((d) => {\n        return d.toUTCString()\n    }))\n    return dates;\n}\n\n// If DTSTART is a date-time value then EXDATEs must also be date-times (c) RFC5545\nfunction add_exdates(icalEvent: ClassSectionEvent, exdates: Date[]) {\n    let hours = icalEvent.dtstart.getUTCHours();\n    let minutes = icalEvent.dtstart.getUTCMinutes();\n    let exdatesCopies = [];\n    for (let exdate of exdates) {\n        if (!icalEvent.rrule.byDay.toLowerCase().includes(exdate.toUTCString().slice(0, 2).toLowerCase()))\n            continue;\n        let newDate = new Date(exdate.getTime());\n        newDate.setUTCHours(hours);\n        newDate.setUTCMinutes(minutes);\n        exdatesCopies.push(newDate);\n    }\n    icalEvent.exclude = exdatesCopies;\n}\n// PARSING\n\nfunction parseSchedule(schedule: string): ClassSectionEvent[] {\n    schedule = normalizeWhitespace(schedule);\n    const classNames = schedule.match(reClassName)\n    if (!classNames)\n        throw new Error(\"Couldn't find any class sections in your schedule. Please, check your schedule or contact my author.\")\n    const classSectionBatches = schedule.split(reClassName);\n    classSectionBatches.shift() // classSectionBatches[0] == ''\n    let all_class_sections = [];\n    for (let i = 0; i < classNames.length; i++) {\n        let rawSectionBatch = classSectionBatches[i];\n        // In case we get a class without class times, handling it seems unnecessary as it is most likely a fully online\n        // class.\n        // TODO: What if the class info somehow contains dropped/withdrawn but in some other section? Ex: Prof name\n        // Idea: Drop one of your classes at the beginning of some semester and see if it works.\n        if (rawSectionBatch.includes(\"Dropped\") || rawSectionBatch.includes(\"Withdrawn\"))\n            continue;\n        let sectionBatch = getAllRegexMatches(rawSectionBatch, reClassSection)\n        let sectionType: string;\n        let lastSectionType: string = \"\";\n        for (let section of sectionBatch) {\n            let info: any = section.groups;\n            if (sectionType = info.sectionType)\n                lastSectionType = sectionType;\n            all_class_sections.push(createClassSection(\n                classNames[i], lastSectionType, info.weekdays,\n                info.startTime, info.endTime, info.location,\n                info.professors, info.dtstart, info.dtend\n            ))\n        }\n    }\n    return all_class_sections\n}\n\nfunction normalizeWhitespace(str: string): string {\n    return str.replace(reLeadingLineWhitespace, '').replace(reEndingLineWhitespace, '').replace(/\\n+/gm, \"\\n\");\n}\n\nfunction getAllRegexMatches(str: string, regex: RegExp): RegExpExecArray[] {\n    let matches: RegExpExecArray[] = [];\n    let match: RegExpExecArray | null;\n    while ((match = regex.exec(str)) !== null)\n        matches.push(match);\n    return matches;\n}\n\nasync function getUCFNoSchoolEvents(year: number, term: string): Promise<IcalEvent[]> {\n    let json;\n    try {\n        json = await (await fetch(`https://calendar.ucf.edu/json/${year}/${term}`)).json()\n    }\n    catch (exception) {\n        console.log(exception)\n        throw new Error(\"Couldn't connect to calendar.ucf.edu to get no-school events. Either check your internet connection and try again or uncheck 'I am a UCF student' tickbox.\");\n    }\n    let events = []\n    for (let event of json.terms[0].events) {\n        // Sometimes it has an event with no dtstart and no dtend called \"Study day\"\n        // This check also protects us against events with no summaries\n        if (event.tags && event.tags.includes(\"no-classes\") && event.dtstart && event.summary) {\n            let dtstart = new Date(event.dtstart);\n            let dtend: Date;\n            if (!event.dtend) {\n                dtend = new Date(dtstart.getTime());\n                dtend.setUTCDate(dtend.getUTCDate() + 1);\n            }\n            else\n                dtend = new Date(event.dtend);\n            let description: string = event.description || \"\";\n            description = description.trim();\n            events.push({\n                summary: event.summary.trim(),\n                dtstart: dtstart,\n                dtend: dtend,\n                description: description,\n            });\n        }\n    }\n    return events;\n}\n\n// Да пошли вы в жопу со своими JS-библиотеками. КТО-НИБУДЬ ВООБЩЕ МОЖЕТ РЕАЛИЗОВАТЬ ПОЛНЫЙ ФУНКЦИОНАЛ ICAL?\n// Миллион библиотек, но ни одной рабочей. Сам реализую.\n// P.s. https://xkcd.com/927/\n\nfunction createIcalString(name: string, timezone: string, classSections: ClassSectionEvent[], noSchoolEvents: IcalEvent[]): string {\n    let ics = new ICS(timezone);\n    let tz = `;TZID=${timezone}`\n    let creationDate = ics.toDatetime(new Date()) + \"Z\"\n    let ical = `\n    BEGIN:VCALENDAR\n    VERSION:2.0\n    METHOD:REQUEST\n    PRODID:-//Ovsyanka83//UnischedulerTS//EN\n    SUMMARY:${name}\n    DTSTAMP:${creationDate} \n    CREATED:${creationDate}\n    LAST-MODIFIED:${creationDate}\n    `\n    for (let e of classSections)\n        ical += `\n        BEGIN:VEVENT\n        UID:${ics.uid(e.dtstart)}\n        DTSTAMP:${ics.dtStamp}\n        SUMMARY:${e.summary}\n        DESCRIPTION:${e.description}\n        LOCATION:${e.location}\n        DTSTART;VALUE=DATE-TIME${tz}:${ics.toDatetime(e.dtstart)}\n        DTEND;VALUE=DATE-TIME${tz}:${ics.toDatetime(e.dtend)}\n        RRULE:FREQ=WEEKLY;BYDAY=${e.rrule.byDay};INTERVAL=1;UNTIL=${ics.toDatetime(e.rrule.until)}Z\n        ${ics.exdateField(e.exclude)}\n        END:VEVENT\n        `\n    for (let e of noSchoolEvents)\n        ical += `\n        BEGIN:VEVENT\n        UID:${ics.uid(e.dtstart)}\n        DTSTAMP:${ics.dtStamp}\n        SUMMARY:${e.summary}\n        DESCRIPTION:${e.description}\n        DTSTART;VALUE=DATE${tz}:${ics.toDate(e.dtstart)}\n        DTEND;VALUE=DATE${tz}:${ics.toDate(e.dtend)}\n        END:VEVENT\n        `\n    ical += \"\\nEND:VCALENDAR\"\n    return ics.normalize(ical);\n}\n\nclass ICS {\n    timezone: string\n    dtStamp: string\n\n    constructor(timezone: string) {\n        this.timezone = timezone;\n        this.dtStamp = this.toDatetime(new Date()) + \"Z\";\n    }\n\n    toDatetime(dt: Date): string {\n        // 20210411T090000\n        return `${this.toDate(dt)}T${this.toTime(dt)}`;\n    }\n\n    toDate(dt: Date): string {\n        // 20210411\n        return dt.getUTCFullYear() + pad(dt.getUTCMonth() + 1) + pad(dt.getUTCDate());\n    }\n\n    toTime(dt: Date): string {\n        // 093000\n        return pad(dt.getUTCHours()) + pad(dt.getUTCMinutes()) + pad(dt.getUTCSeconds());\n    }\n\n    exdateField(exdates: Date[]) {\n        let exdateList = this.toExdateList(exdates);\n        if (exdateList)\n            return \"EXDATE:\" + exdateList;\n        else\n            return \"\";\n    }\n\n    toExdateList(dates: Date[]): string {\n        // EXDATE:20210118T090000Z,20210411T090000Z,20210412T090000Z\n        return dates.map(this.toDatetime, this).join(\",\")\n    }\n\n    // This is necessary because RFC 5545 does not allow:\n    //  trailing whitespace, blank lines, or lines longer than 75 chars\n    normalize(ical: string): string {\n        return foldLines(normalizeWhitespace(ical))\n    }\n\n    uid(dt: Date) {\n        // I know that this uid is weird and unsafe but it gets the job done without extra dependencies\n        return `${this.dtStamp}-${this.toDatetime(dt)}-${randrange(6).join('')}@oatmeal.cc`\n    }\n\n}\n\nfunction pad(n: number): string {\n    if (n < 10)\n        return '0' + n;\n    else\n        return '' + n\n}\n\nfunction foldLines(text: string) {\n    return text.match(/[^\\r\\n]+/g)?.map(foldLine).join(\"\\r\\n\");\n}\n\nfunction foldLine(line: string) {\n    const parts = []\n    let length = 75\n    while (line.length > length) {\n        parts.push(line.slice(0, length))\n        line = line.slice(length)\n        length = 74\n    }\n    parts.push(line)\n    return parts.join('\\r\\n ')\n}\n\nfunction randrange(rangeSize: number): number[] {\n    let range: number[] = new Array(rangeSize);\n    for (let i = 0; i < rangeSize; i++)\n        range.push(Math.floor(Math.random() * Math.floor(10)))\n    return range;\n}","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = {};\n__webpack_modules__[903]();\n"],"sourceRoot":""}